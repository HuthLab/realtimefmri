version: '3'

services:
  realtimefmri:
    build:
      context: .
      dockerfile: Dockerfile.realtimefmri
    command: web_interface
    devices:
      - "${EVENT_DEVICE}:/dev/input/event3"
    ports:
      - "127.0.0.1:8050:8050"
      - "127.0.0.1:8051:8051"
    volumes:
      - "${PYCORTEX_STORE}:/data/pycortex_store"
      - "${PIPELINE_PATH}:/root/.local/share/realtimefmri/pipelines"
      - "${TEST_DATASET_PATH}:/root/.local/share/realtimefmri/datasets"
      - scanner:/root/.local/share/realtimefmri/scanner
    restart: always

  redis:
    image: redis
    restart: always

  samba:
    build:
      context: "./samba"
      dockerfile: Dockerfile
    ports:
      - "0.0.0.0:139:139"
      - "0.0.0.0:445:445"
    volumes:
      - scanner:/mnt/scanner

volumes:
  scanner: